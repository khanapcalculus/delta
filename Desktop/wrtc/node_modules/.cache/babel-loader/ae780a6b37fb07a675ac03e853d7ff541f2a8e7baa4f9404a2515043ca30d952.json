{"ast":null,"code":"class WebRTCManager {\n  constructor() {\n    this.localConnection = null;\n    this.dataChannel = null;\n    this.isHost = false;\n    this.roomId = null;\n    this.onDataReceived = null;\n    this.onConnectionStateChange = null;\n    this.isConnected = false;\n    this.answerProcessed = false;\n    this.offerProcessed = false;\n    this.answerPolling = null;\n    this.offerPolling = null;\n\n    // Use Google's STUN servers for NAT traversal\n    this.iceServers = [{\n      urls: 'stun:stun.l.google.com:19302'\n    }, {\n      urls: 'stun:stun1.l.google.com:19302'\n    }, {\n      urls: 'stun:stun2.l.google.com:19302'\n    }];\n  }\n  async initialize(roomId, isHost = false) {\n    this.roomId = roomId;\n    this.isHost = isHost;\n    console.log(`üöÄ Initializing WebRTC - Room: ${roomId}, Role: ${isHost ? 'HOST' : 'GUEST'}`);\n    console.log('üåê Current origin:', window.location.origin);\n\n    // Clear any existing data for this room first\n    this.cleanup();\n    try {\n      // Create RTCPeerConnection with optimized configuration\n      this.localConnection = new RTCPeerConnection({\n        iceServers: this.iceServers,\n        iceCandidatePoolSize: 10,\n        bundlePolicy: 'max-bundle',\n        rtcpMuxPolicy: 'require'\n      });\n\n      // Set up comprehensive connection state monitoring\n      this.localConnection.onconnectionstatechange = () => {\n        var _this$dataChannel, _this$dataChannel2;\n        console.log('üîÑ Connection state changed:', this.localConnection.connectionState);\n        switch (this.localConnection.connectionState) {\n          case 'connected':\n            console.log('üéâ PEER CONNECTION ESTABLISHED!');\n            console.log('üìã Checking data channel state:', (_this$dataChannel = this.dataChannel) === null || _this$dataChannel === void 0 ? void 0 : _this$dataChannel.readyState);\n\n            // Update connection status if data channel is also ready\n            if (((_this$dataChannel2 = this.dataChannel) === null || _this$dataChannel2 === void 0 ? void 0 : _this$dataChannel2.readyState) === 'open') {\n              console.log('‚úÖ Both peer connection and data channel are ready!');\n              this.isConnected = true;\n              if (this.onConnectionStateChange) {\n                this.onConnectionStateChange(true);\n              }\n            } else {\n              console.log('‚è≥ Peer connection ready, waiting for data channel...');\n            }\n            break;\n          case 'disconnected':\n            console.log('‚ö†Ô∏è Peer connection disconnected');\n            this.isConnected = false;\n            if (this.onConnectionStateChange) {\n              this.onConnectionStateChange(false);\n            }\n            break;\n          case 'failed':\n            console.log('‚ùå Peer connection failed');\n            this.isConnected = false;\n            if (this.onConnectionStateChange) {\n              this.onConnectionStateChange(false);\n            }\n            break;\n          case 'closed':\n            console.log('üîí Peer connection closed');\n            this.isConnected = false;\n            if (this.onConnectionStateChange) {\n              this.onConnectionStateChange(false);\n            }\n            break;\n          case 'connecting':\n            console.log('üîÑ Peer connection is connecting...');\n            break;\n        }\n      };\n      this.localConnection.oniceconnectionstatechange = () => {\n        console.log('üßä ICE connection state changed:', this.localConnection.iceConnectionState);\n        switch (this.localConnection.iceConnectionState) {\n          case 'checking':\n            console.log('üîç ICE checking connectivity...');\n            break;\n          case 'connected':\n            console.log('‚úÖ ICE connected successfully!');\n            break;\n          case 'completed':\n            console.log('üéØ ICE connection completed!');\n            break;\n          case 'failed':\n            console.log('‚ùå ICE connection failed');\n            break;\n          case 'disconnected':\n            console.log('‚ö†Ô∏è ICE disconnected');\n            break;\n          case 'closed':\n            console.log('üîí ICE connection closed');\n            break;\n        }\n      };\n      this.localConnection.onsignalingstatechange = () => {\n        console.log('üì° Signaling state changed:', this.localConnection.signalingState);\n      };\n      if (isHost) {\n        await this.setupAsHost();\n      } else {\n        await this.setupAsGuest();\n      }\n    } catch (error) {\n      console.error('‚ùå WebRTC initialization failed:', error);\n      throw error;\n    }\n  }\n  async setupAsHost() {\n    console.log('üîµ Setting up as HOST for room:', this.roomId);\n\n    // Create data channel with optimized settings\n    this.dataChannel = this.localConnection.createDataChannel('whiteboard', {\n      ordered: true,\n      // Ensure drawing data arrives in order\n      maxRetransmits: 3\n    });\n    console.log('üì° Data channel created by host:', {\n      label: this.dataChannel.label,\n      readyState: this.dataChannel.readyState,\n      id: this.dataChannel.id\n    });\n    this.setupDataChannel(this.dataChannel);\n\n    // Monitor data channel state changes\n    this.dataChannel.addEventListener('statechange', () => {\n      console.log('üîÑ Host data channel state changed:', this.dataChannel.readyState);\n    });\n\n    // Handle ICE candidates\n    this.localConnection.onicecandidate = event => {\n      if (event.candidate) {\n        console.log('üßä Host ICE candidate generated');\n        this.storeIceCandidate(event.candidate, 'host');\n      } else {\n        console.log('‚úÖ Host ICE gathering complete');\n      }\n    };\n\n    // Create offer\n    console.log('üìù Creating offer...');\n    const offer = await this.localConnection.createOffer();\n    await this.localConnection.setLocalDescription(offer);\n\n    // Store offer in localStorage with multiple methods\n    const offerData = {\n      offer: offer,\n      timestamp: Date.now(),\n      roomId: this.roomId\n    };\n\n    // Method 1: Standard localStorage\n    const offerKey = `offer_${this.roomId}`;\n    localStorage.setItem(offerKey, JSON.stringify(offerData));\n\n    // Method 2: Force localStorage sync with storage event\n    window.dispatchEvent(new StorageEvent('storage', {\n      key: offerKey,\n      newValue: JSON.stringify(offerData),\n      url: window.location.href\n    }));\n\n    // Method 3: Also store in global variable for same-page access\n    window.webrtcOffers = window.webrtcOffers || {};\n    window.webrtcOffers[this.roomId] = offerData;\n    console.log('üíæ Offer stored with multiple methods:', offerData);\n    console.log('üîç Verifying storage immediately:');\n    console.log('  - localStorage:', localStorage.getItem(offerKey));\n    console.log('  - window.webrtcOffers:', window.webrtcOffers[this.roomId]);\n\n    // Populate manual signaling field\n    setTimeout(() => {\n      const offerTextarea = document.getElementById('offerData');\n      if (offerTextarea) {\n        offerTextarea.value = JSON.stringify(offerData);\n        console.log('üìù Populated manual offer textarea');\n      }\n    }, 500);\n    console.log('‚úÖ Host setup complete. Room ID:', this.roomId);\n    console.log('‚è≥ Waiting for answer...');\n\n    // Listen for answer\n    this.waitForAnswer();\n  }\n  async setupAsGuest() {\n    console.log('üü¢ Setting up as GUEST for room:', this.roomId);\n\n    // Handle ICE candidates\n    this.localConnection.onicecandidate = event => {\n      if (event.candidate) {\n        console.log('üßä Guest ICE candidate generated');\n        this.storeIceCandidate(event.candidate, 'guest');\n      } else {\n        console.log('‚úÖ Guest ICE gathering complete');\n      }\n    };\n\n    // Wait for offer\n    console.log('üîç Looking for offer...');\n    const offerData = await this.waitForOffer();\n    if (!offerData) {\n      throw new Error('No offer found for this room');\n    }\n    console.log('üì• Offer received, setting as remote description...');\n    console.log('üìã Current signaling state:', this.localConnection.signalingState);\n    try {\n      await this.localConnection.setRemoteDescription(offerData.offer);\n      console.log('‚úÖ Remote description (offer) set successfully');\n    } catch (error) {\n      console.error('‚ùå Failed to set remote description (offer):', error);\n      throw error;\n    }\n\n    // Listen for data channel from host\n    this.localConnection.ondatachannel = event => {\n      console.log('üì° Data channel received from host');\n      console.log('üìã Data channel details:', {\n        label: event.channel.label,\n        readyState: event.channel.readyState,\n        id: event.channel.id\n      });\n      this.dataChannel = event.channel;\n      this.setupDataChannel(this.dataChannel);\n\n      // Force connection state check after receiving data channel\n      setTimeout(() => {\n        var _this$dataChannel3;\n        console.log('üîç Connection state after data channel setup:');\n        console.log('  - Connection state:', this.localConnection.connectionState);\n        console.log('  - ICE connection state:', this.localConnection.iceConnectionState);\n        console.log('  - Data channel state:', (_this$dataChannel3 = this.dataChannel) === null || _this$dataChannel3 === void 0 ? void 0 : _this$dataChannel3.readyState);\n        console.log('  - Signaling state:', this.localConnection.signalingState);\n      }, 500);\n    };\n\n    // Create answer\n    console.log('üìù Creating answer...');\n    const answer = await this.localConnection.createAnswer();\n    console.log('üí° Answer created:', answer);\n    await this.localConnection.setLocalDescription(answer);\n    console.log('‚úÖ Local description (answer) set successfully');\n\n    // Store answer using multiple methods\n    const answerData = {\n      answer: answer,\n      timestamp: Date.now(),\n      roomId: this.roomId\n    };\n    localStorage.setItem(`answer_${this.roomId}`, JSON.stringify(answerData));\n\n    // Global variable fallback\n    window.webrtcAnswers = window.webrtcAnswers || {};\n    window.webrtcAnswers[this.roomId] = answerData;\n    console.log('üíæ Answer stored with multiple methods');\n\n    // Auto-populate the answer textarea for manual copy/paste\n    setTimeout(() => {\n      const answerTextarea = document.getElementById('answerData');\n      if (answerTextarea) {\n        var _answerData$answer, _answerData$answer2, _answerData$answer2$s;\n        answerTextarea.value = JSON.stringify(answerData);\n        console.log('üìù Auto-populated answer textarea');\n        console.log('üîç Answer data structure:', JSON.stringify(answerData, null, 2));\n        console.log('üîç Answer.answer.type:', (_answerData$answer = answerData.answer) === null || _answerData$answer === void 0 ? void 0 : _answerData$answer.type);\n        console.log('üîç Answer.answer.sdp length:', (_answerData$answer2 = answerData.answer) === null || _answerData$answer2 === void 0 ? void 0 : (_answerData$answer2$s = _answerData$answer2.sdp) === null || _answerData$answer2$s === void 0 ? void 0 : _answerData$answer2$s.length);\n      }\n    }, 100);\n    console.log('‚úÖ Guest setup complete');\n\n    // Process stored ICE candidates from host\n    setTimeout(() => {\n      this.processStoredIceCandidates('host');\n    }, 1000);\n  }\n  setupDataChannel(channel) {\n    console.log('üîß Setting up data channel...');\n    console.log('üìã Initial data channel state:', channel.readyState);\n    channel.onopen = () => {\n      console.log('üéâ DATA CHANNEL OPENED - CONNECTION ESTABLISHED!');\n      console.log('üìã Final connection states:');\n      console.log('  - Connection state:', this.localConnection.connectionState);\n      console.log('  - ICE connection state:', this.localConnection.iceConnectionState);\n      console.log('  - Data channel state:', channel.readyState);\n      console.log('  - Signaling state:', this.localConnection.signalingState);\n      this.isConnected = true;\n      if (this.onConnectionStateChange) {\n        this.onConnectionStateChange(true);\n      }\n    };\n    channel.onclose = () => {\n      console.log('‚ùå Data channel closed');\n      this.isConnected = false;\n      if (this.onConnectionStateChange) {\n        this.onConnectionStateChange(false);\n      }\n    };\n    channel.onerror = error => {\n      console.error('‚ùå Data channel error:', error);\n      console.log('üìã Data channel state during error:', channel.readyState);\n    };\n    channel.onmessage = event => {\n      try {\n        const data = JSON.parse(event.data);\n        console.log('üì® Data received:', data.type);\n        if (this.onDataReceived) {\n          this.onDataReceived(data);\n        }\n      } catch (error) {\n        console.error('‚ùå Failed to parse received data:', error);\n      }\n    };\n\n    // Monitor data channel state changes\n    channel.addEventListener('statechange', () => {\n      console.log('üîÑ Data channel state changed:', channel.readyState);\n    });\n    console.log('‚úÖ Data channel event handlers set up');\n  }\n  async waitForOffer() {\n    return new Promise((resolve, reject) => {\n      let attempts = 0;\n      const maxAttempts = 300; // 5 minutes (300 seconds)\n\n      this.offerPolling = setInterval(() => {\n        attempts++;\n        console.log(`üîç Looking for offer... attempt ${attempts}/${maxAttempts} (${Math.floor(attempts / 60)}:${(attempts % 60).toString().padStart(2, '0')})`);\n\n        // Debug: Show all localStorage keys and global variables\n        const allKeys = Object.keys(localStorage);\n        const roomKeys = allKeys.filter(k => k.includes(this.roomId));\n        console.log('üì¶ All localStorage keys:', allKeys.length);\n        console.log('üì¶ Room-specific keys:', roomKeys);\n        console.log('üåê Global offers:', window.webrtcOffers);\n\n        // Try multiple methods to find the offer\n        let offerData = null;\n\n        // Method 1: localStorage\n        const localStorageOffer = localStorage.getItem(`offer_${this.roomId}`);\n        if (localStorageOffer) {\n          console.log('‚úÖ Found offer in localStorage');\n          offerData = localStorageOffer;\n        }\n\n        // Method 2: Global variable\n        if (!offerData && window.webrtcOffers && window.webrtcOffers[this.roomId]) {\n          console.log('‚úÖ Found offer in global variable');\n          offerData = JSON.stringify(window.webrtcOffers[this.roomId]);\n        }\n        if (offerData) {\n          try {\n            const parsed = JSON.parse(offerData);\n            console.log('üìÑ Found offer data:', parsed);\n\n            // Check if offer is not too old (10 minutes)\n            if (Date.now() - parsed.timestamp < 600000) {\n              console.log('‚úÖ Valid offer found!');\n              clearInterval(this.offerPolling);\n              this.offerProcessed = true;\n              resolve(parsed);\n              return;\n            } else {\n              console.log('‚ùå Offer too old, removing...');\n              localStorage.removeItem(`offer_${this.roomId}`);\n              if (window.webrtcOffers) {\n                delete window.webrtcOffers[this.roomId];\n              }\n            }\n          } catch (error) {\n            console.error('‚ùå Failed to parse offer:', error);\n          }\n        } else {\n          console.log('‚ùå No offer found with any method');\n        }\n        if (attempts >= maxAttempts) {\n          clearInterval(this.offerPolling);\n          reject(new Error('Timeout waiting for offer'));\n        }\n      }, 1000);\n    });\n  }\n  async waitForAnswer() {\n    let attempts = 0;\n    const maxAttempts = 300; // 5 minutes (300 seconds)\n\n    this.answerPolling = setInterval(async () => {\n      attempts++;\n      console.log(`üîç Looking for answer... attempt ${attempts}/${maxAttempts} (${Math.floor(attempts / 60)}:${(attempts % 60).toString().padStart(2, '0')})`);\n\n      // Debug: Show localStorage and global variables\n      const allKeys = Object.keys(localStorage);\n      const roomKeys = allKeys.filter(k => k.includes(this.roomId));\n      console.log('üì¶ Room-specific keys:', roomKeys);\n      console.log('üåê Global answers:', window.webrtcAnswers);\n\n      // Try multiple methods to find the answer\n      let answerData = null;\n\n      // Method 1: localStorage\n      const localStorageAnswer = localStorage.getItem(`answer_${this.roomId}`);\n      if (localStorageAnswer) {\n        console.log('‚úÖ Found answer in localStorage');\n        answerData = localStorageAnswer;\n      }\n\n      // Method 2: Global variable\n      if (!answerData && window.webrtcAnswers && window.webrtcAnswers[this.roomId]) {\n        console.log('‚úÖ Found answer in global variable');\n        answerData = JSON.stringify(window.webrtcAnswers[this.roomId]);\n      }\n      if (answerData) {\n        try {\n          const parsed = JSON.parse(answerData);\n          console.log('üìÑ Found answer data:', parsed);\n\n          // Check connection state before setting remote description\n          console.log('üìã Current signaling state:', this.localConnection.signalingState);\n          if (this.localConnection.signalingState === 'have-local-offer') {\n            console.log('‚úÖ Answer received, setting as remote description...');\n            await this.localConnection.setRemoteDescription(parsed.answer);\n            clearInterval(this.answerPolling);\n            this.answerProcessed = true;\n\n            // Process guest ICE candidates\n            setTimeout(() => {\n              this.processStoredIceCandidates('guest');\n            }, 1000);\n            console.log('‚úÖ Remote description (answer) set successfully');\n            return;\n          } else {\n            console.log('‚ö†Ô∏è Wrong signaling state for answer:', this.localConnection.signalingState);\n          }\n        } catch (error) {\n          console.error('‚ùå Failed to set remote description (answer):', error);\n          clearInterval(this.answerPolling);\n        }\n      } else {\n        console.log('‚ùå No answer found with any method');\n      }\n      if (attempts >= maxAttempts) {\n        clearInterval(this.answerPolling);\n        console.error('‚ùå Timeout waiting for answer');\n      }\n    }, 1000);\n  }\n  storeIceCandidate(candidate, role) {\n    const key = `ice_${this.roomId}_${role}`;\n    const existing = JSON.parse(localStorage.getItem(key) || '[]');\n    existing.push({\n      candidate: candidate,\n      timestamp: Date.now()\n    });\n    localStorage.setItem(key, JSON.stringify(existing));\n    console.log(`üíæ Stored ICE candidate for ${role}`);\n\n    // Update manual ICE fields\n    this.updateManualIceFields(role);\n  }\n  updateManualIceFields(role) {\n    setTimeout(() => {\n      const key = `ice_${this.roomId}_${role}`;\n      const candidates = JSON.parse(localStorage.getItem(key) || '[]');\n      if (role === 'host') {\n        const hostTextarea = document.getElementById('hostIceCandidates');\n        if (hostTextarea && candidates.length > 0) {\n          hostTextarea.value = JSON.stringify(candidates);\n          console.log(`üìù Updated host ICE textarea with ${candidates.length} candidates`);\n        }\n      } else if (role === 'guest') {\n        const guestTextarea = document.getElementById('guestIceCandidates');\n        if (guestTextarea && candidates.length > 0) {\n          guestTextarea.value = JSON.stringify(candidates);\n          console.log(`üìù Updated guest ICE textarea with ${candidates.length} candidates`);\n        }\n      }\n    }, 100);\n  }\n  async processStoredIceCandidates(role) {\n    const key = `ice_${this.roomId}_${role}`;\n    const candidates = JSON.parse(localStorage.getItem(key) || '[]');\n    console.log(`üßä Processing ${candidates.length} ICE candidates for ${role}`);\n    for (const candidateData of candidates) {\n      try {\n        if (this.localConnection.signalingState !== 'closed') {\n          await this.localConnection.addIceCandidate(candidateData.candidate);\n          console.log(`‚úÖ Added ICE candidate for ${role}`);\n        }\n      } catch (error) {\n        console.error(`‚ùå Failed to add ICE candidate for ${role}:`, error);\n      }\n    }\n\n    // Check connection state after processing ICE candidates\n    setTimeout(() => {\n      var _this$dataChannel4;\n      console.log('üîç Current connection states:');\n      console.log('  - Connection state:', this.localConnection.connectionState);\n      console.log('  - ICE connection state:', this.localConnection.iceConnectionState);\n      console.log('  - Data channel state:', (_this$dataChannel4 = this.dataChannel) === null || _this$dataChannel4 === void 0 ? void 0 : _this$dataChannel4.readyState);\n    }, 2000);\n  }\n  sendData(data) {\n    if (this.dataChannel && this.dataChannel.readyState === 'open') {\n      try {\n        this.dataChannel.send(JSON.stringify(data));\n      } catch (error) {\n        console.error('‚ùå Failed to send data:', error);\n      }\n    } else {\n      var _this$dataChannel5;\n      console.warn('‚ö†Ô∏è Data channel not ready, state:', ((_this$dataChannel5 = this.dataChannel) === null || _this$dataChannel5 === void 0 ? void 0 : _this$dataChannel5.readyState) || 'null');\n    }\n  }\n  cleanup() {\n    if (this.roomId) {\n      const keys = [`offer_${this.roomId}`, `answer_${this.roomId}`, `ice_${this.roomId}_host`, `ice_${this.roomId}_guest`];\n      keys.forEach(key => localStorage.removeItem(key));\n\n      // Clean global variables too\n      if (window.webrtcOffers) {\n        delete window.webrtcOffers[this.roomId];\n      }\n      if (window.webrtcAnswers) {\n        delete window.webrtcAnswers[this.roomId];\n      }\n      console.log('üßπ Cleaned up localStorage and global variables for room:', this.roomId);\n    }\n  }\n  disconnect() {\n    console.log('üîå Disconnecting WebRTC...');\n\n    // Clear polling intervals\n    if (this.answerPolling) {\n      clearInterval(this.answerPolling);\n      this.answerPolling = null;\n    }\n    if (this.offerPolling) {\n      clearInterval(this.offerPolling);\n      this.offerPolling = null;\n    }\n    this.isConnected = false;\n    this.answerProcessed = false;\n    this.offerProcessed = false;\n    if (this.dataChannel) {\n      this.dataChannel.close();\n    }\n    if (this.localConnection) {\n      this.localConnection.close();\n    }\n    this.cleanup();\n    console.log('‚úÖ Disconnection complete');\n  }\n}\nexport default WebRTCManager;","map":{"version":3,"names":["WebRTCManager","constructor","localConnection","dataChannel","isHost","roomId","onDataReceived","onConnectionStateChange","isConnected","answerProcessed","offerProcessed","answerPolling","offerPolling","iceServers","urls","initialize","console","log","window","location","origin","cleanup","RTCPeerConnection","iceCandidatePoolSize","bundlePolicy","rtcpMuxPolicy","onconnectionstatechange","_this$dataChannel","_this$dataChannel2","connectionState","readyState","oniceconnectionstatechange","iceConnectionState","onsignalingstatechange","signalingState","setupAsHost","setupAsGuest","error","createDataChannel","ordered","maxRetransmits","label","id","setupDataChannel","addEventListener","onicecandidate","event","candidate","storeIceCandidate","offer","createOffer","setLocalDescription","offerData","timestamp","Date","now","offerKey","localStorage","setItem","JSON","stringify","dispatchEvent","StorageEvent","key","newValue","url","href","webrtcOffers","getItem","setTimeout","offerTextarea","document","getElementById","value","waitForAnswer","waitForOffer","Error","setRemoteDescription","ondatachannel","channel","_this$dataChannel3","answer","createAnswer","answerData","webrtcAnswers","answerTextarea","_answerData$answer","_answerData$answer2","_answerData$answer2$s","type","sdp","length","processStoredIceCandidates","onopen","onclose","onerror","onmessage","data","parse","Promise","resolve","reject","attempts","maxAttempts","setInterval","Math","floor","toString","padStart","allKeys","Object","keys","roomKeys","filter","k","includes","localStorageOffer","parsed","clearInterval","removeItem","localStorageAnswer","role","existing","push","updateManualIceFields","candidates","hostTextarea","guestTextarea","candidateData","addIceCandidate","_this$dataChannel4","sendData","send","_this$dataChannel5","warn","forEach","disconnect","close"],"sources":["C:/Users/eniac/Desktop/wrtc/src/services/WebRTCManager.js"],"sourcesContent":["class WebRTCManager {\n  constructor() {\n    this.localConnection = null;\n    this.dataChannel = null;\n    this.isHost = false;\n    this.roomId = null;\n    this.onDataReceived = null;\n    this.onConnectionStateChange = null;\n    this.isConnected = false;\n    this.answerProcessed = false;\n    this.offerProcessed = false;\n    this.answerPolling = null;\n    this.offerPolling = null;\n    \n    // Use Google's STUN servers for NAT traversal\n    this.iceServers = [\n      { urls: 'stun:stun.l.google.com:19302' },\n      { urls: 'stun:stun1.l.google.com:19302' },\n      { urls: 'stun:stun2.l.google.com:19302' }\n    ];\n  }\n\n  async initialize(roomId, isHost = false) {\n    this.roomId = roomId;\n    this.isHost = isHost;\n    \n    console.log(`üöÄ Initializing WebRTC - Room: ${roomId}, Role: ${isHost ? 'HOST' : 'GUEST'}`);\n    console.log('üåê Current origin:', window.location.origin);\n    \n    // Clear any existing data for this room first\n    this.cleanup();\n    \n    try {\n      // Create RTCPeerConnection with optimized configuration\n      this.localConnection = new RTCPeerConnection({\n        iceServers: this.iceServers,\n        iceCandidatePoolSize: 10,\n        bundlePolicy: 'max-bundle',\n        rtcpMuxPolicy: 'require'\n      });\n\n      // Set up comprehensive connection state monitoring\n      this.localConnection.onconnectionstatechange = () => {\n        console.log('üîÑ Connection state changed:', this.localConnection.connectionState);\n        \n        switch(this.localConnection.connectionState) {\n          case 'connected':\n            console.log('üéâ PEER CONNECTION ESTABLISHED!');\n            console.log('üìã Checking data channel state:', this.dataChannel?.readyState);\n            \n            // Update connection status if data channel is also ready\n            if (this.dataChannel?.readyState === 'open') {\n              console.log('‚úÖ Both peer connection and data channel are ready!');\n              this.isConnected = true;\n              if (this.onConnectionStateChange) {\n                this.onConnectionStateChange(true);\n              }\n            } else {\n              console.log('‚è≥ Peer connection ready, waiting for data channel...');\n            }\n            break;\n          case 'disconnected':\n            console.log('‚ö†Ô∏è Peer connection disconnected');\n            this.isConnected = false;\n            if (this.onConnectionStateChange) {\n              this.onConnectionStateChange(false);\n            }\n            break;\n          case 'failed':\n            console.log('‚ùå Peer connection failed');\n            this.isConnected = false;\n            if (this.onConnectionStateChange) {\n              this.onConnectionStateChange(false);\n            }\n            break;\n          case 'closed':\n            console.log('üîí Peer connection closed');\n            this.isConnected = false;\n            if (this.onConnectionStateChange) {\n              this.onConnectionStateChange(false);\n            }\n            break;\n          case 'connecting':\n            console.log('üîÑ Peer connection is connecting...');\n            break;\n        }\n      };\n\n      this.localConnection.oniceconnectionstatechange = () => {\n        console.log('üßä ICE connection state changed:', this.localConnection.iceConnectionState);\n        \n        switch(this.localConnection.iceConnectionState) {\n          case 'checking':\n            console.log('üîç ICE checking connectivity...');\n            break;\n          case 'connected':\n            console.log('‚úÖ ICE connected successfully!');\n            break;\n          case 'completed':\n            console.log('üéØ ICE connection completed!');\n            break;\n          case 'failed':\n            console.log('‚ùå ICE connection failed');\n            break;\n          case 'disconnected':\n            console.log('‚ö†Ô∏è ICE disconnected');\n            break;\n          case 'closed':\n            console.log('üîí ICE connection closed');\n            break;\n        }\n      };\n\n      this.localConnection.onsignalingstatechange = () => {\n        console.log('üì° Signaling state changed:', this.localConnection.signalingState);\n      };\n\n      if (isHost) {\n        await this.setupAsHost();\n      } else {\n        await this.setupAsGuest();\n      }\n    } catch (error) {\n      console.error('‚ùå WebRTC initialization failed:', error);\n      throw error;\n    }\n  }\n\n  async setupAsHost() {\n    console.log('üîµ Setting up as HOST for room:', this.roomId);\n    \n    // Create data channel with optimized settings\n    this.dataChannel = this.localConnection.createDataChannel('whiteboard', {\n      ordered: true,  // Ensure drawing data arrives in order\n      maxRetransmits: 3\n    });\n    \n    console.log('üì° Data channel created by host:', {\n      label: this.dataChannel.label,\n      readyState: this.dataChannel.readyState,\n      id: this.dataChannel.id\n    });\n    \n    this.setupDataChannel(this.dataChannel);\n    \n    // Monitor data channel state changes\n    this.dataChannel.addEventListener('statechange', () => {\n      console.log('üîÑ Host data channel state changed:', this.dataChannel.readyState);\n    });\n    \n    // Handle ICE candidates\n    this.localConnection.onicecandidate = (event) => {\n      if (event.candidate) {\n        console.log('üßä Host ICE candidate generated');\n        this.storeIceCandidate(event.candidate, 'host');\n      } else {\n        console.log('‚úÖ Host ICE gathering complete');\n      }\n    };\n    \n    // Create offer\n    console.log('üìù Creating offer...');\n    const offer = await this.localConnection.createOffer();\n    await this.localConnection.setLocalDescription(offer);\n    \n    // Store offer in localStorage with multiple methods\n    const offerData = {\n      offer: offer,\n      timestamp: Date.now(),\n      roomId: this.roomId\n    };\n    \n    // Method 1: Standard localStorage\n    const offerKey = `offer_${this.roomId}`;\n    localStorage.setItem(offerKey, JSON.stringify(offerData));\n    \n    // Method 2: Force localStorage sync with storage event\n    window.dispatchEvent(new StorageEvent('storage', {\n      key: offerKey,\n      newValue: JSON.stringify(offerData),\n      url: window.location.href\n    }));\n    \n    // Method 3: Also store in global variable for same-page access\n    window.webrtcOffers = window.webrtcOffers || {};\n    window.webrtcOffers[this.roomId] = offerData;\n    \n    console.log('üíæ Offer stored with multiple methods:', offerData);\n    console.log('üîç Verifying storage immediately:');\n    console.log('  - localStorage:', localStorage.getItem(offerKey));\n    console.log('  - window.webrtcOffers:', window.webrtcOffers[this.roomId]);\n    \n    // Populate manual signaling field\n    setTimeout(() => {\n      const offerTextarea = document.getElementById('offerData');\n      if (offerTextarea) {\n        offerTextarea.value = JSON.stringify(offerData);\n        console.log('üìù Populated manual offer textarea');\n      }\n    }, 500);\n    \n    console.log('‚úÖ Host setup complete. Room ID:', this.roomId);\n    console.log('‚è≥ Waiting for answer...');\n    \n    // Listen for answer\n    this.waitForAnswer();\n  }\n\n  async setupAsGuest() {\n    console.log('üü¢ Setting up as GUEST for room:', this.roomId);\n    \n    // Handle ICE candidates\n    this.localConnection.onicecandidate = (event) => {\n      if (event.candidate) {\n        console.log('üßä Guest ICE candidate generated');\n        this.storeIceCandidate(event.candidate, 'guest');\n      } else {\n        console.log('‚úÖ Guest ICE gathering complete');\n      }\n    };\n    \n    // Wait for offer\n    console.log('üîç Looking for offer...');\n    const offerData = await this.waitForOffer();\n    if (!offerData) {\n      throw new Error('No offer found for this room');\n    }\n    \n    console.log('üì• Offer received, setting as remote description...');\n    console.log('üìã Current signaling state:', this.localConnection.signalingState);\n    \n    try {\n      await this.localConnection.setRemoteDescription(offerData.offer);\n      console.log('‚úÖ Remote description (offer) set successfully');\n    } catch (error) {\n      console.error('‚ùå Failed to set remote description (offer):', error);\n      throw error;\n    }\n    \n    // Listen for data channel from host\n    this.localConnection.ondatachannel = (event) => {\n      console.log('üì° Data channel received from host');\n      console.log('üìã Data channel details:', {\n        label: event.channel.label,\n        readyState: event.channel.readyState,\n        id: event.channel.id\n      });\n      \n      this.dataChannel = event.channel;\n      this.setupDataChannel(this.dataChannel);\n      \n      // Force connection state check after receiving data channel\n      setTimeout(() => {\n        console.log('üîç Connection state after data channel setup:');\n        console.log('  - Connection state:', this.localConnection.connectionState);\n        console.log('  - ICE connection state:', this.localConnection.iceConnectionState);\n        console.log('  - Data channel state:', this.dataChannel?.readyState);\n        console.log('  - Signaling state:', this.localConnection.signalingState);\n      }, 500);\n    };\n    \n    // Create answer\n    console.log('üìù Creating answer...');\n    const answer = await this.localConnection.createAnswer();\n    console.log('üí° Answer created:', answer);\n    \n    await this.localConnection.setLocalDescription(answer);\n    console.log('‚úÖ Local description (answer) set successfully');\n    \n    // Store answer using multiple methods\n    const answerData = {\n      answer: answer,\n      timestamp: Date.now(),\n      roomId: this.roomId\n    };\n    localStorage.setItem(`answer_${this.roomId}`, JSON.stringify(answerData));\n    \n    // Global variable fallback\n    window.webrtcAnswers = window.webrtcAnswers || {};\n    window.webrtcAnswers[this.roomId] = answerData;\n    \n    console.log('üíæ Answer stored with multiple methods');\n    \n    // Auto-populate the answer textarea for manual copy/paste\n    setTimeout(() => {\n      const answerTextarea = document.getElementById('answerData');\n      if (answerTextarea) {\n        answerTextarea.value = JSON.stringify(answerData);\n        console.log('üìù Auto-populated answer textarea');\n        console.log('üîç Answer data structure:', JSON.stringify(answerData, null, 2));\n        console.log('üîç Answer.answer.type:', answerData.answer?.type);\n        console.log('üîç Answer.answer.sdp length:', answerData.answer?.sdp?.length);\n      }\n    }, 100);\n    \n    console.log('‚úÖ Guest setup complete');\n    \n    // Process stored ICE candidates from host\n    setTimeout(() => {\n      this.processStoredIceCandidates('host');\n    }, 1000);\n  }\n\n  setupDataChannel(channel) {\n    console.log('üîß Setting up data channel...');\n    console.log('üìã Initial data channel state:', channel.readyState);\n    \n    channel.onopen = () => {\n      console.log('üéâ DATA CHANNEL OPENED - CONNECTION ESTABLISHED!');\n      console.log('üìã Final connection states:');\n      console.log('  - Connection state:', this.localConnection.connectionState);\n      console.log('  - ICE connection state:', this.localConnection.iceConnectionState);\n      console.log('  - Data channel state:', channel.readyState);\n      console.log('  - Signaling state:', this.localConnection.signalingState);\n      \n      this.isConnected = true;\n      if (this.onConnectionStateChange) {\n        this.onConnectionStateChange(true);\n      }\n    };\n    \n    channel.onclose = () => {\n      console.log('‚ùå Data channel closed');\n      this.isConnected = false;\n      if (this.onConnectionStateChange) {\n        this.onConnectionStateChange(false);\n      }\n    };\n    \n    channel.onerror = (error) => {\n      console.error('‚ùå Data channel error:', error);\n      console.log('üìã Data channel state during error:', channel.readyState);\n    };\n    \n    channel.onmessage = (event) => {\n      try {\n        const data = JSON.parse(event.data);\n        console.log('üì® Data received:', data.type);\n        if (this.onDataReceived) {\n          this.onDataReceived(data);\n        }\n      } catch (error) {\n        console.error('‚ùå Failed to parse received data:', error);\n      }\n    };\n    \n    // Monitor data channel state changes\n    channel.addEventListener('statechange', () => {\n      console.log('üîÑ Data channel state changed:', channel.readyState);\n    });\n    \n    console.log('‚úÖ Data channel event handlers set up');\n  }\n\n  async waitForOffer() {\n    return new Promise((resolve, reject) => {\n      let attempts = 0;\n      const maxAttempts = 300; // 5 minutes (300 seconds)\n      \n      this.offerPolling = setInterval(() => {\n        attempts++;\n        console.log(`üîç Looking for offer... attempt ${attempts}/${maxAttempts} (${Math.floor(attempts/60)}:${(attempts%60).toString().padStart(2,'0')})`);\n        \n        // Debug: Show all localStorage keys and global variables\n        const allKeys = Object.keys(localStorage);\n        const roomKeys = allKeys.filter(k => k.includes(this.roomId));\n        console.log('üì¶ All localStorage keys:', allKeys.length);\n        console.log('üì¶ Room-specific keys:', roomKeys);\n        console.log('üåê Global offers:', window.webrtcOffers);\n        \n        // Try multiple methods to find the offer\n        let offerData = null;\n        \n        // Method 1: localStorage\n        const localStorageOffer = localStorage.getItem(`offer_${this.roomId}`);\n        if (localStorageOffer) {\n          console.log('‚úÖ Found offer in localStorage');\n          offerData = localStorageOffer;\n        }\n        \n        // Method 2: Global variable\n        if (!offerData && window.webrtcOffers && window.webrtcOffers[this.roomId]) {\n          console.log('‚úÖ Found offer in global variable');\n          offerData = JSON.stringify(window.webrtcOffers[this.roomId]);\n        }\n        \n        if (offerData) {\n          try {\n            const parsed = JSON.parse(offerData);\n            console.log('üìÑ Found offer data:', parsed);\n            \n            // Check if offer is not too old (10 minutes)\n            if (Date.now() - parsed.timestamp < 600000) {\n              console.log('‚úÖ Valid offer found!');\n              clearInterval(this.offerPolling);\n              this.offerProcessed = true;\n              resolve(parsed);\n              return;\n            } else {\n              console.log('‚ùå Offer too old, removing...');\n              localStorage.removeItem(`offer_${this.roomId}`);\n              if (window.webrtcOffers) {\n                delete window.webrtcOffers[this.roomId];\n              }\n            }\n          } catch (error) {\n            console.error('‚ùå Failed to parse offer:', error);\n          }\n        } else {\n          console.log('‚ùå No offer found with any method');\n        }\n        \n        if (attempts >= maxAttempts) {\n          clearInterval(this.offerPolling);\n          reject(new Error('Timeout waiting for offer'));\n        }\n      }, 1000);\n    });\n  }\n\n  async waitForAnswer() {\n    let attempts = 0;\n    const maxAttempts = 300; // 5 minutes (300 seconds)\n    \n    this.answerPolling = setInterval(async () => {\n      attempts++;\n      console.log(`üîç Looking for answer... attempt ${attempts}/${maxAttempts} (${Math.floor(attempts/60)}:${(attempts%60).toString().padStart(2,'0')})`);\n      \n      // Debug: Show localStorage and global variables\n      const allKeys = Object.keys(localStorage);\n      const roomKeys = allKeys.filter(k => k.includes(this.roomId));\n      console.log('üì¶ Room-specific keys:', roomKeys);\n      console.log('üåê Global answers:', window.webrtcAnswers);\n      \n      // Try multiple methods to find the answer\n      let answerData = null;\n      \n      // Method 1: localStorage\n      const localStorageAnswer = localStorage.getItem(`answer_${this.roomId}`);\n      if (localStorageAnswer) {\n        console.log('‚úÖ Found answer in localStorage');\n        answerData = localStorageAnswer;\n      }\n      \n      // Method 2: Global variable\n      if (!answerData && window.webrtcAnswers && window.webrtcAnswers[this.roomId]) {\n        console.log('‚úÖ Found answer in global variable');\n        answerData = JSON.stringify(window.webrtcAnswers[this.roomId]);\n      }\n      \n      if (answerData) {\n        try {\n          const parsed = JSON.parse(answerData);\n          console.log('üìÑ Found answer data:', parsed);\n          \n          // Check connection state before setting remote description\n          console.log('üìã Current signaling state:', this.localConnection.signalingState);\n          \n          if (this.localConnection.signalingState === 'have-local-offer') {\n            console.log('‚úÖ Answer received, setting as remote description...');\n            await this.localConnection.setRemoteDescription(parsed.answer);\n            \n            clearInterval(this.answerPolling);\n            this.answerProcessed = true;\n            \n            // Process guest ICE candidates\n            setTimeout(() => {\n              this.processStoredIceCandidates('guest');\n            }, 1000);\n            \n            console.log('‚úÖ Remote description (answer) set successfully');\n            return;\n          } else {\n            console.log('‚ö†Ô∏è Wrong signaling state for answer:', this.localConnection.signalingState);\n          }\n        } catch (error) {\n          console.error('‚ùå Failed to set remote description (answer):', error);\n          clearInterval(this.answerPolling);\n        }\n      } else {\n        console.log('‚ùå No answer found with any method');\n      }\n      \n      if (attempts >= maxAttempts) {\n        clearInterval(this.answerPolling);\n        console.error('‚ùå Timeout waiting for answer');\n      }\n    }, 1000);\n  }\n\n  storeIceCandidate(candidate, role) {\n    const key = `ice_${this.roomId}_${role}`;\n    const existing = JSON.parse(localStorage.getItem(key) || '[]');\n    existing.push({\n      candidate: candidate,\n      timestamp: Date.now()\n    });\n    localStorage.setItem(key, JSON.stringify(existing));\n    console.log(`üíæ Stored ICE candidate for ${role}`);\n    \n    // Update manual ICE fields\n    this.updateManualIceFields(role);\n  }\n\n  updateManualIceFields(role) {\n    setTimeout(() => {\n      const key = `ice_${this.roomId}_${role}`;\n      const candidates = JSON.parse(localStorage.getItem(key) || '[]');\n      \n      if (role === 'host') {\n        const hostTextarea = document.getElementById('hostIceCandidates');\n        if (hostTextarea && candidates.length > 0) {\n          hostTextarea.value = JSON.stringify(candidates);\n          console.log(`üìù Updated host ICE textarea with ${candidates.length} candidates`);\n        }\n      } else if (role === 'guest') {\n        const guestTextarea = document.getElementById('guestIceCandidates');\n        if (guestTextarea && candidates.length > 0) {\n          guestTextarea.value = JSON.stringify(candidates);\n          console.log(`üìù Updated guest ICE textarea with ${candidates.length} candidates`);\n        }\n      }\n    }, 100);\n  }\n\n  async processStoredIceCandidates(role) {\n    const key = `ice_${this.roomId}_${role}`;\n    const candidates = JSON.parse(localStorage.getItem(key) || '[]');\n    \n    console.log(`üßä Processing ${candidates.length} ICE candidates for ${role}`);\n    \n    for (const candidateData of candidates) {\n      try {\n        if (this.localConnection.signalingState !== 'closed') {\n          await this.localConnection.addIceCandidate(candidateData.candidate);\n          console.log(`‚úÖ Added ICE candidate for ${role}`);\n        }\n      } catch (error) {\n        console.error(`‚ùå Failed to add ICE candidate for ${role}:`, error);\n      }\n    }\n    \n    // Check connection state after processing ICE candidates\n    setTimeout(() => {\n      console.log('üîç Current connection states:');\n      console.log('  - Connection state:', this.localConnection.connectionState);\n      console.log('  - ICE connection state:', this.localConnection.iceConnectionState);\n      console.log('  - Data channel state:', this.dataChannel?.readyState);\n    }, 2000);\n  }\n\n  sendData(data) {\n    if (this.dataChannel && this.dataChannel.readyState === 'open') {\n      try {\n        this.dataChannel.send(JSON.stringify(data));\n      } catch (error) {\n        console.error('‚ùå Failed to send data:', error);\n      }\n    } else {\n      console.warn('‚ö†Ô∏è Data channel not ready, state:', this.dataChannel?.readyState || 'null');\n    }\n  }\n\n  cleanup() {\n    if (this.roomId) {\n      const keys = [`offer_${this.roomId}`, `answer_${this.roomId}`, `ice_${this.roomId}_host`, `ice_${this.roomId}_guest`];\n      keys.forEach(key => localStorage.removeItem(key));\n      \n      // Clean global variables too\n      if (window.webrtcOffers) {\n        delete window.webrtcOffers[this.roomId];\n      }\n      if (window.webrtcAnswers) {\n        delete window.webrtcAnswers[this.roomId];\n      }\n      \n      console.log('üßπ Cleaned up localStorage and global variables for room:', this.roomId);\n    }\n  }\n\n  disconnect() {\n    console.log('üîå Disconnecting WebRTC...');\n    \n    // Clear polling intervals\n    if (this.answerPolling) {\n      clearInterval(this.answerPolling);\n      this.answerPolling = null;\n    }\n    if (this.offerPolling) {\n      clearInterval(this.offerPolling);\n      this.offerPolling = null;\n    }\n    \n    this.isConnected = false;\n    this.answerProcessed = false;\n    this.offerProcessed = false;\n    \n    if (this.dataChannel) {\n      this.dataChannel.close();\n    }\n    if (this.localConnection) {\n      this.localConnection.close();\n    }\n    \n    this.cleanup();\n    console.log('‚úÖ Disconnection complete');\n  }\n}\n\nexport default WebRTCManager; "],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}